<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Interval Pro | Alain C.</title>
    <style>
        :root {
            --bg-walk: #05140f;
            --bg-run: #1a0505;
            --accent-walk: #00ff88;
            --accent-run: #ff4444;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-walk);
            color: white;
            font-family: -apple-system, system-ui, sans-serif;
            display: flex; flex-direction: column;
            align-items: center; justify-content: space-around;
            height: 100vh; width: 100vw;
            transition: background-color 1s ease;
            overflow: hidden;
        }

        /* ANIMATIONS */
        @keyframes bg-pulse-walk { 0%, 100% { background-color: #05140f; } 50% { background-color: #0a2e1f; } }
        @keyframes bg-pulse-run { 0%, 100% { background-color: #1a0505; } 50% { background-color: #4d0a0a; } }
        .pulse-walk { animation: bg-pulse-walk 2s infinite ease-in-out; }
        .pulse-run { animation: bg-pulse-run 1.2s infinite ease-in-out; }

        header h1 { font-size: 1.1rem; letter-spacing: 6px; opacity: 0.4; margin-top: 20px; }

        .timer-container {
            position: relative;
            width: 280px; height: 280px;
            display: flex; align-items: center; justify-content: center;
        }
        
        svg { transform: rotate(-90deg); width: 280px; height: 280px; z-index: 2; }
        circle { fill: none; stroke-width: 10; stroke-linecap: round; }
        .track { stroke: rgba(255, 255, 255, 0.05); }
        .progress {
            stroke-dasharray: 816;
            stroke: var(--accent-walk);
            transition: stroke-dashoffset 1s linear, stroke 0.5s ease;
        }

        .timer-content { position: absolute; text-align: center; z-index: 3; }
        .mode-badge {
            background: rgba(255, 255, 255, 0.1); padding: 4px 15px; border-radius: 20px;
            font-size: 0.7rem; letter-spacing: 2px; margin-bottom: 5px; text-transform: uppercase;
        }
        .time-display { font-size: 5rem; font-weight: 200; font-variant-numeric: tabular-nums; line-height: 1; }

        .cycle-box { text-align: center; }
        .cycle-label { font-size: 0.6rem; letter-spacing: 2px; color: rgba(255,255,255,0.4); text-transform: uppercase; }
        .cycle-val { font-size: 2.2rem; font-weight: bold; }

        .settings-card { 
            width: 85%; max-width: 380px; 
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .settings-card.hidden { opacity: 0; transform: scale(0.95) translateY(30px); pointer-events: none; height: 0; margin: 0; }

        .slider-box {
            background: rgba(255, 255, 255, 0.06); padding: 16px; border-radius: 20px;
            margin-bottom: 12px; border: 1px solid rgba(255, 255, 255, 0.03);
        }
        .slider-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.8rem; }
        
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 10px; }
        input[type=range]::-webkit-slider-thumb {
            height: 22px; width: 22px; border-radius: 50%; background: white;
            -webkit-appearance: none; margin-top: -9px;
        }

        .controls { display: flex; align-items: center; gap: 30px; padding-bottom: 10px; }
        .btn-reset { background: rgba(255,255,255,0.1); border: none; width: 50px; height: 50px; border-radius: 50%; color: white; font-size: 1.2rem; cursor: pointer; }
        .btn-play { background: white; color: black; width: 80px; height: 80px; border-radius: 50%; font-size: 2rem; border: none; cursor: pointer; }

        footer { font-size: 0.6rem; letter-spacing: 4px; color: rgba(255,255,255,0.2); padding-bottom: 15px; }
    </style>
</head>
<body id="body">

    <header><h1>INTERVAL</h1></header>

    <div class="timer-container">
        <svg>
            <circle class="track" cx="140" cy="140" r="130"></circle>
            <circle id="progressCircle" class="progress" cx="140" cy="140" r="130"></circle>
        </svg>
        <div class="timer-content">
            <div id="mode-badge" class="mode-badge">WALK</div>
            <div id="display" class="time-display">02:00</div>
        </div>
    </div>

    <div class="cycle-box">
        <div class="cycle-label">Cycles</div>
        <div id="cycle-count" class="cycle-val">0</div>
    </div>

    <div id="settingsCard" class="settings-card">
        <div class="slider-box">
            <div class="slider-header">WALK <span id="walkVal" style="color:var(--accent-walk)">02:00</span></div>
            <input type="range" id="walkSlider" min="5" max="600" step="5" value="120" oninput="updateTime('walk', this.value)">
        </div>
        <div class="slider-box">
            <div class="slider-header">RUN <span id="runVal" style="color:var(--accent-run)">01:00</span></div>
            <input type="range" id="runSlider" min="5" max="600" step="5" value="60" oninput="updateTime('run', this.value)">
        </div>
    </div>

    <div class="controls">
        <button class="btn-reset" onclick="location.reload()">↺</button>
        <button id="playBtn" class="btn-play" onclick="toggleTimer()">▶</button>
    </div>

    <footer>BY ALAIN C.</footer>

<script>
    let timeLeft, totalTime, isRunning = false, currentMode = 'walk', cycles = 0;
    let walkSeconds = 120, runSeconds = 60;
    let timerInterval, heartbeat;

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const progressCircle = document.getElementById('progressCircle');
    const circumference = 2 * Math.PI * 130;
    progressCircle.style.strokeDasharray = circumference;

    function formatTime(s) {
        const m = Math.floor(s / 60);
        const sec = s % 60;
        return `${m.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
    }

    function updateTime(type, val) {
        if (isRunning) return;
        if (type === 'walk') {
            walkSeconds = parseInt(val);
            document.getElementById('walkVal').innerText = formatTime(walkSeconds);
        } else {
            runSeconds = parseInt(val);
            document.getElementById('runVal').innerText = formatTime(runSeconds);
        }
        timeLeft = currentMode === 'walk' ? walkSeconds : runSeconds;
        document.getElementById('display').innerText = formatTime(timeLeft);
    }

    // SILENT HEARTBEAT to keep the CPU awake
    function startHeartbeat() {
        const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate, audioCtx.sampleRate);
        const source = audioCtx.createBufferSource();
        source.buffer = buffer;
        source.loop = true;
        const gain = audioCtx.createGain();
        gain.gain.value = 0.01; 
        source.connect(gain);
        gain.connect(audioCtx.destination);
        source.start();
        return source;
    }

    function speak(txt) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(txt);
        msg.rate = 1.1;
        window.speechSynthesis.speak(msg);
    }

    function playBeep(freq) {
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.frequency.value = freq;
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.1);
        osc.connect(g); g.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.1);
    }

    function toggleTimer() {
        if (!isRunning) {
            audioCtx.resume();
            heartbeat = startHeartbeat();
            isRunning = true;
            document.getElementById('playBtn').innerText = '||';
            document.getElementById('settingsCard').classList.add('hidden');
            document.getElementById('body').classList.add(currentMode === 'walk' ? 'pulse-walk' : 'pulse-run');
            totalTime = timeLeft || (currentMode === 'walk' ? walkSeconds : runSeconds);
            if (!timeLeft) timeLeft = totalTime;
            speak("Start " + currentMode);
            timerInterval = setInterval(tick, 1000);
        } else {
            clearInterval(timerInterval);
            if (heartbeat) heartbeat.stop();
            isRunning = false;
            document.getElementById('playBtn').innerText = '▶';
            document.getElementById('settingsCard').classList.remove('hidden');
            document.getElementById('body').classList.remove('pulse-walk', 'pulse-run');
            speak("Paused");
        }
    }

    function tick() {
        if (timeLeft > 0) {
            timeLeft--;
            document.getElementById('display').innerText = formatTime(timeLeft);
            const offset = circumference - (timeLeft / totalTime * circumference);
            progressCircle.style.strokeDashoffset = offset;
            if (timeLeft < 5 && timeLeft > 0) playBeep(currentMode === 'run' ? 880 : 440);
        } else {
            currentMode = (currentMode === 'walk') ? 'run' : 'walk';
            if (currentMode === 'walk') {
                cycles++;
                document.getElementById('cycle-count').innerText = cycles;
                progressCircle.style.stroke = "var(--accent-walk)";
                document.getElementById('mode-badge').innerText = "WALK";
            } else {
                progressCircle.style.stroke = "var(--accent-run)";
                document.getElementById('mode-badge').innerText = "RUN";
            }
            document.getElementById('body').className = (currentMode === 'walk' ? 'pulse-walk' : 'pulse-run');
            timeLeft = currentMode === 'walk' ? walkSeconds : runSeconds;
            totalTime = timeLeft;
            speak(currentMode + " phase");
        }
    }

    timeLeft = walkSeconds;
</script>
</body>
</html>
