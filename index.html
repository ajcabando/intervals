<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Interval Pro | Alain C.</title>
    <style>
        :root {
            --bg-walk: #05140f; --bg-run: #1a0505;
            --accent-walk: #00ff88; --accent-run: #ff4444;
        }

        body {
            margin: 0; padding: 0; background-color: var(--bg-walk); color: white;
            font-family: -apple-system, system-ui, sans-serif;
            display: flex; flex-direction: column; align-items: center;
            justify-content: space-around; height: 100vh; width: 100vw;
            transition: background-color 1s ease; overflow: hidden; user-select: none;
        }

        @keyframes bg-pulse-walk { 0%, 100% { background-color: #05140f; } 50% { background-color: #0a2e1f; } }
        @keyframes bg-pulse-run { 0%, 100% { background-color: #1a0505; } 50% { background-color: #4d0a0a; } }
        .pulse-walk { animation: bg-pulse-walk 2.5s infinite ease-in-out; }
        .pulse-run { animation: bg-pulse-run 1.5s infinite ease-in-out; }

        .timer-container { position: relative; width: 300px; height: 300px; display: flex; align-items: center; justify-content: center; }
        
        .ring-pulse {
            position: absolute; width: 260px; height: 260px; border-radius: 50%;
            border: 4px solid var(--accent-walk); opacity: 0; z-index: 1;
        }
        .active-ring-pulse { animation: ring-ani 2s infinite; }
        @keyframes ring-ani { 0% { transform: scale(1); opacity: 0.6; } 100% { transform: scale(1.4); opacity: 0; } }
        
        svg { transform: rotate(-90deg); width: 300px; height: 300px; z-index: 2; }
        circle { fill: none; stroke-width: 10; stroke-linecap: round; }
        .track { stroke: rgba(255, 255, 255, 0.05); }
        .progress { stroke-dasharray: 816; stroke: var(--accent-walk); transition: stroke-dashoffset 0.3s linear, stroke 0.5s ease; }

        .timer-content { position: absolute; text-align: center; z-index: 3; }
        .mode-badge {
            background: rgba(255, 255, 255, 0.1); padding: 5px 20px; border-radius: 20px;
            font-size: 0.7rem; letter-spacing: 3px; margin-bottom: 5px; text-transform: uppercase;
        }
        .time-display { font-size: 5rem; font-weight: 200; font-variant-numeric: tabular-nums; line-height: 1; }

        .cycle-box { text-align: center; z-index: 5; margin-bottom: -20px; }
        .cycle-label { font-size: 0.7rem; letter-spacing: 2px; color: rgba(255,255,255,0.4); text-transform: uppercase; }
        .cycle-val { font-size: 2rem; font-weight: bold; }

        .settings-card { width: 85%; max-width: 400px; transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        .settings-card.hidden { opacity: 0; transform: scale(0.9) translateY(40px); pointer-events: none; height: 0; margin: 0; }

        .slider-box { background: rgba(255, 255, 255, 0.06); padding: 14px; border-radius: 20px; margin-bottom: 8px; border: 1px solid rgba(255, 255, 255, 0.03); }
        .slider-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.8rem; font-weight: 600; opacity: 0.8;}
        
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 10px; }
        input[type=range]::-webkit-slider-thumb { height: 20px; width: 20px; border-radius: 50%; background: white; -webkit-appearance: none; margin-top: -8px; }

        .controls { display: flex; align-items: center; gap: 20px; height: 100px; }
        .btn-play { background: white; color: black; width: 80px; height: 80px; border-radius: 50%; font-size: 2rem; border: none; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; }
        .btn-stop { background: rgba(255,255,255,0.1); color: white; width: 60px; height: 60px; border-radius: 50%; font-size: 1.2rem; border: none; cursor: pointer; display: none; }

        footer { font-size: 0.6rem; opacity: 0.3; letter-spacing: 3px; padding-bottom: 10px; }
    </style>
</head>
<body id="body">

    <header><h1 style="font-size: 1rem; letter-spacing: 5px; opacity: 0.4;">INTERVAL PRO</h1></header>

    <div class="cycle-box">
        <div class="cycle-label">Cycle</div>
        <div id="cycle-count" class="cycle-val">1</div>
    </div>

    <div class="timer-container">
        <div id="ringPulse" class="ring-pulse"></div>
        <svg><circle class="track" cx="150" cy="150" r="130"></circle><circle id="progressCircle" class="progress" cx="150" cy="150" r="130"></circle></svg>
        <div class="timer-content">
            <div id="mode-badge" class="mode-badge">WALK</div>
            <div id="display" class="time-display">02:00</div>
        </div>
    </div>

    <div id="settingsCard" class="settings-card">
        <div class="slider-box">
            <div class="slider-header">WALK <span id="walkVal" style="color:var(--accent-walk)">02:00</span></div>
            <input type="range" min="5" max="600" step="5" value="120" oninput="updateTime('walk', this.value)">
        </div>
        <div class="slider-box">
            <div class="slider-header">RUN <span id="runVal" style="color:var(--accent-run)">01:00</span></div>
            <input type="range" min="5" max="600" step="5" value="60" oninput="updateTime('run', this.value)">
        </div>
        <div class="slider-box" style="background: rgba(255,255,255,0.12);">
            <div class="slider-header"><span>ðŸ”Š VOLUME & HAPTIC</span> <span id="volPerc">80%</span></div>
            <input type="range" min="0" max="1" step="0.1" value="0.8" oninput="updateVolume(this.value)">
        </div>
    </div>

    <div class="controls">
        <button class="btn-stop" id="stopBtn" onclick="stopTimer()">â—¼</button>
        <button class="btn-play" id="playBtn" onclick="handlePlayPause()">â–¶</button>
    </div>

    <footer>ALAIN C.</footer>

<script>
    let walkSec = 120, runSec = 60, isRunning = false, vol = 0.8;
    let mode = 'walk', cycles = 1, timeLeft = 120, timerInterval, wakeLock = null, silentNode = null;
    
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const progressCircle = document.getElementById('progressCircle');
    const ringPulse = document.getElementById('ringPulse');
    const playBtn = document.getElementById('playBtn');
    const stopBtn = document.getElementById('stopBtn');
    const circumference = 816; 

    function fmt(s) { return Math.floor(s/60).toString().padStart(2,'0') + ":" + (s%60).toString().padStart(2,'0'); }

    function updateTime(type, val) {
        if (isRunning) return;
        if (type === 'walk') { walkSec = parseInt(val); }
        else { runSec = parseInt(val); }
        document.getElementById('walkVal').innerText = fmt(walkSec);
        document.getElementById('runVal').innerText = fmt(runSec);
        timeLeft = (mode === 'walk' ? walkSec : runSec);
        document.getElementById('display').innerText = fmt(timeLeft);
    }

    function updateVolume(v) {
        vol = v;
        document.getElementById('volPerc').innerText = Math.round(v * 100) + "%";
    }

    function triggerVibration() {
        if (vol > 0 && "vibrate" in navigator) navigator.vibrate([400, 200, 400]);
    }

    function playBeep(freq) {
        if (vol === 0) return;
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        g.gain.setValueAtTime(vol * 0.1, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
        osc.connect(g); g.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.2);
    }

    function speak(txt) {
        if (vol === 0) return;
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(txt);
        msg.volume = vol;
        window.speechSynthesis.speak(msg);
    }

    async function handlePlayPause() {
        if (!isRunning) {
            startTimer();
        } else {
            pauseTimer();
        }
    }

    async function startTimer() {
        await audioCtx.resume();
        if (!silentNode) {
            const buffer = audioCtx.createBuffer(1, 1, 44100);
            silentNode = audioCtx.createBufferSource();
            silentNode.buffer = buffer;
            silentNode.loop = true;
            silentNode.connect(audioCtx.destination);
            silentNode.start();
        }
        
        isRunning = true;
        playBtn.innerText = 'II';
        stopBtn.style.display = 'block';
        document.getElementById('settingsCard').classList.add('hidden');
        ringPulse.classList.add('active-ring-pulse');
        
        if ('wakeLock' in navigator && !wakeLock) {
            try { wakeLock = await navigator.wakeLock.request('screen'); } catch (e) {}
        }

        document.body.className = (mode === 'walk' ? 'pulse-walk' : 'pulse-run');
        const accent = (mode === 'walk' ? 'var(--accent-walk)' : 'var(--accent-run)');
        progressCircle.style.stroke = accent;
        ringPulse.style.borderColor = accent;

        timerInterval = setInterval(refresh, 1000);
        speak(mode === 'walk' ? "Walking phase" : "Running phase");
    }

    function pauseTimer() {
        isRunning = false;
        clearInterval(timerInterval);
        playBtn.innerText = 'â–¶';
        ringPulse.classList.remove('active-ring-pulse');
        document.body.className = '';
        speak("Paused");
    }

    function stopTimer() {
        location.reload(); // Full reset
    }

    function refresh() {
        if (timeLeft > 0) {
            timeLeft--;
            if (timeLeft <= 3 && timeLeft > 0) playBeep(500);
        } else {
            // Switch Modes
            if (mode === 'run') {
                cycles++;
                document.getElementById('cycle-count').innerText = cycles;
                mode = 'walk';
            } else {
                mode = 'run';
            }
            timeLeft = (mode === 'walk' ? walkSec : runSec);
            triggerVibration();
            speak(mode);
            
            // UI Update for new mode
            document.body.className = (mode === 'walk' ? 'pulse-walk' : 'pulse-run');
            const accent = (mode === 'walk' ? 'var(--accent-walk)' : 'var(--accent-run)');
            progressCircle.style.stroke = accent;
            ringPulse.style.borderColor = accent;
            document.getElementById('mode-badge').innerText = mode;
        }

        document.getElementById('display').innerText = fmt(timeLeft);
        let total = (mode === 'walk' ? walkSec : runSec);
        progressCircle.style.strokeDashoffset = circumference - ((timeLeft / total) * circumference);
    }
</script>
</body>
</html>
