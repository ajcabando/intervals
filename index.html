<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Interval Pro | Alain C.</title>
    <style>
        :root {
            --bg-walk: #05140f;
            --bg-run: #1a0505;
            --accent-walk: #00ff88;
            --accent-run: #ff4444;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-walk);
            color: white;
            font-family: -apple-system, system-ui, sans-serif;
            display: flex; flex-direction: column;
            align-items: center; justify-content: space-around;
            height: 100vh; width: 100vw;
            transition: background-color 1s ease;
            overflow: hidden;
            user-select: none;
        }

        /* ANIMATIONS */
        @keyframes bg-pulse-walk { 0%, 100% { background-color: #05140f; } 50% { background-color: #0a2e1f; } }
        @keyframes bg-pulse-run { 0%, 100% { background-color: #1a0505; } 50% { background-color: #4d0a0a; } }
        .pulse-walk { animation: bg-pulse-walk 2.5s infinite ease-in-out; }
        .pulse-run { animation: bg-pulse-run 1.5s infinite ease-in-out; }

        header h1 { font-size: 1.1rem; letter-spacing: 8px; opacity: 0.4; margin-top: 20px; }

        .timer-container {
            position: relative;
            width: 320px; height: 320px;
            display: flex; align-items: center; justify-content: center;
        }

        .ring-pulse {
            position: absolute;
            width: 280px; height: 280px;
            border-radius: 50%;
            border: 4px solid var(--accent-walk);
            opacity: 0;
            z-index: 1;
        }
        .active-ring-pulse { animation: ring-ani 2s infinite; }
        @keyframes ring-ani { 
            0% { transform: scale(1); opacity: 0.6; } 
            100% { transform: scale(1.4); opacity: 0; } 
        }
        
        svg { transform: rotate(-90deg); width: 320px; height: 320px; z-index: 2; }
        circle { fill: none; stroke-width: 10; stroke-linecap: round; }
        .track { stroke: rgba(255, 255, 255, 0.05); }
        .progress {
            stroke-dasharray: 880; 
            stroke: var(--accent-walk);
            transition: stroke-dashoffset 0.3s linear, stroke 0.5s ease;
        }

        .timer-content { position: absolute; text-align: center; z-index: 3; }
        .mode-badge {
            background: rgba(255, 255, 255, 0.1); padding: 5px 20px; border-radius: 20px;
            font-size: 0.8rem; letter-spacing: 3px; margin-bottom: 5px; text-transform: uppercase;
        }
        .time-display { font-size: 5.5rem; font-weight: 200; font-variant-numeric: tabular-nums; line-height: 1; }

        .cycle-box { text-align: center; }
        .cycle-label { font-size: 0.7rem; letter-spacing: 2px; color: rgba(255,255,255,0.4); text-transform: uppercase; }
        .cycle-val { font-size: 2.5rem; font-weight: bold; }

        .settings-card { 
            width: 85%; max-width: 400px; 
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .settings-card.hidden { opacity: 0; transform: scale(0.9) translateY(40px); pointer-events: none; height: 0; margin: 0; }

        .slider-box {
            background: rgba(255, 255, 255, 0.06); padding: 18px; border-radius: 24px;
            margin-bottom: 12px; border: 1px solid rgba(255, 255, 255, 0.03);
        }
        .slider-header { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 0.9rem; font-weight: 600; }
        
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; }
        input[type=range]::-webkit-slider-thumb {
            height: 24px; width: 24px; border-radius: 50%; background: white;
            -webkit-appearance: none; margin-top: -9px;
        }

        .controls { display: flex; align-items: center; gap: 40px; padding-bottom: 10px; }
        .btn-reset { background: rgba(255,255,255,0.1); border: none; width: 60px; height: 60px; border-radius: 50%; color: white; font-size: 1.5rem; cursor: pointer; }
        .btn-play { background: white; color: black; width: 90px; height: 90px; border-radius: 50%; font-size: 2.5rem; border: none; cursor: pointer; }

        footer { font-size: 0.7rem; letter-spacing: 5px; color: rgba(255,255,255,0.2); padding-bottom: 20px; }
    </style>
</head>
<body id="body">

    <header><h1>INTERVAL</h1></header>

    <div class="timer-container">
        <div id="ringPulse" class="ring-pulse"></div>
        <svg>
            <circle class="track" cx="160" cy="160" r="140"></circle>
            <circle id="progressCircle" class="progress" cx="160" cy="160" r="140"></circle>
        </svg>
        <div class="timer-content">
            <div id="mode-badge" class="mode-badge">WALK</div>
            <div id="display" class="time-display">02:00</div>
        </div>
    </div>

    <div class="cycle-box">
        <div class="cycle-label">Completed Cycles</div>
        <div id="cycle-count" class="cycle-val">0</div>
    </div>

    <div id="settingsCard" class="settings-card">
        <div class="slider-box">
            <div class="slider-header">WALK <span id="walkVal" style="color:var(--accent-walk)">02:00</span></div>
            <input type="range" id="walkSlider" min="5" max="600" step="5" value="120" oninput="updateTime('walk', this.value)">
        </div>
        <div class="slider-box">
            <div class="slider-header">RUN <span id="runVal" style="color:var(--accent-run)">01:00</span></div>
            <input type="range" id="runSlider" min="5" max="600" step="5" value="60" oninput="updateTime('run', this.value)">
        </div>
    </div>

    <div class="controls">
        <button class="btn-reset" onclick="location.reload()">↺</button>
        <button id="playBtn" class="btn-play" onclick="toggleTimer()">▶</button>
    </div>

    <footer>BY ALAIN C.</footer>

<script>
    let walkSec = 120, runSec = 60, isRunning = false;
    let mode = 'walk', cycles = 0, endTime, timerInterval, wakeLock = null;
    
    const progressCircle = document.getElementById('progressCircle');
    const ringPulse = document.getElementById('ringPulse');
    const circumference = 880; 

    function fmt(s) {
        return Math.floor(s/60).toString().padStart(2,'0') + ":" + (s%60).toString().padStart(2,'0');
    }

    function updateTime(type, val) {
        if (isRunning) return;
        if (type === 'walk') {
            walkSec = parseInt(val);
            document.getElementById('walkVal').innerText = fmt(walkSec);
        } else {
            runSec = parseInt(val);
            document.getElementById('runVal').innerText = fmt(runSec);
        }
        document.getElementById('display').innerText = fmt(mode === 'walk' ? walkSec : runSec);
    }

    // --- SCREEN ON LOCK LOGIC ---
    async function requestWakeLock() {
        try {
            if ('wakeLock' in navigator) {
                wakeLock = await navigator.wakeLock.request('screen');
                console.log('Screen Wake Lock is active');
            }
        } catch (err) {
            console.error(`${err.name}, ${err.message}`);
        }
    }

    function toggleTimer() {
        if (!isRunning) {
            isRunning = true;
            document.getElementById('playBtn').innerText = '||';
            document.getElementById('settingsCard').classList.add('hidden');
            ringPulse.classList.add('active-ring-pulse');
            requestWakeLock(); // Keeps screen on
            startPhase();
        } else {
            location.reload(); 
        }
    }

    function startPhase() {
        let duration = (mode === 'walk' ? walkSec : runSec);
        endTime = Date.now() + (duration * 1000);
        
        document.body.className = (mode === 'walk' ? 'pulse-walk' : 'pulse-run');
        document.getElementById('mode-badge').innerText = mode;
        const accent = (mode === 'walk' ? 'var(--accent-walk)' : 'var(--accent-run)');
        progressCircle.style.stroke = accent;
        ringPulse.style.borderColor = accent;
        
        if(timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(refresh, 250);
    }

    function refresh() {
        let now = Date.now();
        let remaining = Math.ceil((endTime - now) / 1000);

        if (remaining <= 0) {
            mode = (mode === 'walk' ? 'run' : 'walk');
            if (mode === 'walk') {
                cycles++;
                document.getElementById('cycle-count').innerText = cycles;
            }
            startPhase();
            return;
        }

        document.getElementById('display').innerText = fmt(remaining);
        let total = (mode === 'walk' ? walkSec : runSec);
        progressCircle.style.strokeDashoffset = circumference - ((remaining / total) * circumference);
    }

    // Re-request lock if user manually switches tabs and comes back
    document.addEventListener('visibilitychange', async () => {
        if (wakeLock !== null && document.visibilityState === 'visible') {
            await requestWakeLock();
        }
    });

    updateTime('walk', 120);
</script>
</body>
</html>
